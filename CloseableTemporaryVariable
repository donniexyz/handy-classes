package com.samaicita.point.lombok;

import lombok.Getter;

import java.util.function.Consumer;

/**
 *
 * Extending lombok @Cleanup annotation to store a variable and pass it to consumer function upon returning.
 *
 * How to use:
 *
 *      ...
 *      @Cleanup CloseableTemporaryVariable<List> temporaryVariable = new CloseableTemporaryVariable<>(trxGroup.getChilds(), trxGroup::setChilds);
 *      trxGroup.setChilds(null);
 *      ...
 *
 * Translated into java:
 *
 *      ...
 *      CloseableTemporaryVariable<List> temporaryVariable = new CloseableTemporaryVariable<>(trxGroup.getChilds(), trxGroup::setChilds);
 *      // meaning temporaryVariable.data = trxGroup.getChilds()
 *
 *      try {
 *          trxGroup.setChilds(null);
 *          ...
 *      } finally {
 *          if (temporaryVariable != null)
 *              temporaryVariable.close();  // meaning trxGroup.setChilds(temporaryVariable.data)
 *      }
 *
 * @param <T>
 */
@Getter
public class CloseableTemporaryVariable<T> {

    private final T data;
    private final Consumer<T> consumer;

    public CloseableTemporaryVariable(T data, Consumer<T> consumer) {
        this.data = data;
        this.consumer = consumer;
    }

    public void close() {
        consumer.accept(data);
    }
}
